<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-physics-system@4.0.1/dist/aframe-physics-system.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@6.1.0/dist/aframe-extras.min.js"></script>
  </head>
  <body>
    <a-scene>
      <a-assets>
        <img id="ciel" src="asset/Ciel.png" />
        <a-asset-item id="sable" src="asset/Sable.glb"></a-asset-item>
        <a-asset-item id="mairie" src="asset/mairie.glb"></a-asset-item>
        <a-asset-item id="maison" src="asset/dome.glb"></a-asset-item>
        <a-asset-item id="sable" src="asset/sable.glb"></a-asset-item>
        <a-asset-item id="r2d2" src="asset/droide1.glb"></a-asset-item>
        <a-asset-item id="ATST" src="asset/ATST.glb"></a-asset-item>
        <a-asset-item id="destroyer" src="asset/destroyer.glb"></a-asset-item>
        <a-asset-item id="k2so" src="asset/droide2.glb"></a-asset-item>
      </a-assets>
      <a-sky
        src="#ciel"
        position="-50 -50 -50"
        material="opacity: 0.85"
      ></a-sky>
      <a-entity gltf-model="#sable" position="0 0 0" scale="1 1 1"></a-entity>
      <a-entity
        gltf-model="#maison"
        position="3.394 0 -0.970"
        rotation="0 0 0"
      ></a-entity>

      <a-entity
        gltf-model="#maison"
        position="10 0 -0.970"
        rotation="0 0 0"
      ></a-entity>

      <a-entity
        gltf-model="#maison"
        position="16.606 0 -0.970"
        rotation="0 0 0"
      ></a-entity>

      <a-entity
        gltf-model="#mairie"
        position="15.566 1.318 20.211"
        rotation="0 90 0"
      ></a-entity>

      <a-entity
        gltf-model="#r2d2"
        position="16.607 0 17.250"
        rotation="0 -180 0"
      ></a-entity>

      <a-entity
      id="k2so"
      gltf-model="#k2so"
      position="5.472 0 7.606"
      rotation="0 90 0"
      animation-mixer
      animation__move="property: position; to: 18.607 0 7.606; dur: 5000; easing: linear; startEvents: startMove"
      animation__turn1="property: rotation; to: 0 -90 0; dur: 1000; easing: linear; startEvents: moveComplete"
      animation__return="property: position; to: 5.472 0 7.606; dur: 5000; easing: linear; startEvents: turn1Complete"
      animation__turn2="property: rotation; to: 0 90 0; dur: 1000; easing: linear; startEvents: returnComplete"
      event-set__1="_event: animationcomplete__move; _target: #k2so; _event: moveComplete"
      event-set__2="_event: animationcomplete__turn1; _target: #k2so; _event: turn1Complete"
      event-set__3="_event: animationcomplete__return; _target: #k2so; _event: returnComplete"
      event-set__4="_event: animationcomplete__turn2; _target: #k2so; _event: startMove"
      startMove
></a-entity>

      <a-entity
        gltf-model="#ATST"
        position="3.164 0 10.590"
        rotation="0 0 0"
        scale="0.025 0.025 0.025"
      ></a-entity>

      <a-entity
        gltf-model="#destroyer"
        position="-245.467 139.592 20.820"
        rotation="-20 -90 0"
        scale="20 20 20"
      ></a-entity>

      <a-sphere
        position="24.723 3.833 581.876"
        radius="10"
        scale="10 10 10"
        color="#FEE893"
      ></a-sphere>
      <a-sphere
        position="162.861 220.308 533.432"
        radius="10"
        scale="5 5 5"
        color="#FB8C78"
      ></a-sphere>
      <a-camera position="0 1 0"></a-camera>
    </a-scene>

    <script>
      AFRAME.registerComponent('animate-k2so', {
        init: function () {
          this.el.addEventListener('model-loaded', () => {
            this.startWalking();
          });
        },
        startWalking: function () {
          const el = this.el;
          const mixer = el.getObject3D('mesh').mixer;
          const walkAction = mixer.clipAction('Walk');
          const idleAction = mixer.clipAction('Idle');

          walkAction.setLoop(THREE.LoopOnce);
          idleAction.setLoop(THREE.LoopOnce);

          walkAction.play();
          el.emit('walk');

          setTimeout(() => {
            walkAction.stop();
            idleAction.play();
            el.emit('idle');
            setTimeout(() => {
              idleAction.stop();
              this.startWalking();
            }, 2000); // Temps d'arrêt avant de recommencer à marcher
          }, 5000); // Durée de la marche
        }
      });

      document.querySelector('#k2so').setAttribute('animate-k2so', '');
    </script>
  </body>
</html>