<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aframe-physics-system@4.0.1/dist/aframe-physics-system.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@6.1.0/dist/aframe-extras.min.js"></script>
    <title>Tatooine</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body>
    <a-scene>
      <a-assets>
        <img id="ciel" src="asset/Ciel.png" />
        <a-asset-item id="sable" src="./asset/Sable.glb"></a-asset-item>
        <a-asset-item id="mairie" src="./asset/mairie.glb"></a-asset-item>
        <a-asset-item id="maison" src="./asset/dome.glb"></a-asset-item>
        <a-asset-item id="sable" src="./asset/sable.glb"></a-asset-item>
        <a-asset-item id="ATST" src="./asset/star_wars_at-st_rigged.glb"></a-asset-item>
        <a-asset-item id="destroyer" src="./asset/destroyer.glb"></a-asset-item>
        <a-asset-item id="milenium" src="./asset/mileniumfalcon.glb"></a-asset-item>
        <a-asset-item id="tie" src="./asset/tie_chasseur.glb"></a-asset-item>
        <a-asset-item id="cantina" src="./asset/mos_eisley_cantina_star_wars (1).glb"></a-asset-item>
        <a-asset-item id="eglise" src="./asset/eglise.glb"></a-asset-item>
        <a-asset-item id="petitbat" src="./asset/petitbat.glb"></a-asset-item>
        <a-asset-item id="eau" src="./asset/eau.glb"></a-asset-item>
        <a-asset id="cantina_band" src="./asset/CantinaBand.mp3"></a-asset>
        <a-asset id="tatooine_band" src="./asset/TatooineBand.mp3"></a-asset>
        <a-asset id="chameau" src="./asset/eopie_star_wars.glb"></a-asset>
        <a-asset id="banta" src="./asset/star_wars_bantha_walk.glb"></a-asset>
        <a-asset id="trooper" src="./asset/storm_trooper.glb"></a-asset>
      </a-assets>
      <a-sky
        src="#ciel"
        position="-50 -50 -50"
        material="opacity: 0.85"
      ></a-sky>
      <a-sound src="#tatooine_band" autoplay="true" loop="true"></a-sound>
      
      <a-entity gltf-model="#sable" position="0 0 0" scale="1 1 1"></a-entity>

      <a-entity
        gltf-model="#maison"
        position="4.657 0 2.661"
        rotation="0 0 0"
      ></a-entity>

      <a-entity
        gltf-model="#maison"
        position="20.196 0 2.661"
        rotation="0 0 0"
      ></a-entity>

      <a-entity
        gltf-model="#maison"
        position="4.716 0 22.468"
        rotation="0 180 0"
      ></a-entity>

      <a-entity
        gltf-model="#mairie"
        position="15.566 1.318 20.211"
        rotation="0 90 0"
      ></a-entity>

      <a-entity
        gltf-model="#eglise"
        position="36.486 -0.048 25.171"
        rotation="0 -180.000 0"
        scale="0.8 0.8 0.8"
      ></a-entity>

      <a-entity
        gltf-model="#cantina"
        position="31.938 -0.026 -13.197"
        rotation="0 -90 0"
        scale="0.7 0.7 0.7"
      ></a-entity>

      <a-entity
        gltf-model="#petitbat"
        position="14.451 0 3.231"
        rotation="0 0 0"
        scale="0.8 0.8 0.8"
      ></a-entity>

      <a-entity
        gltf-model="#eau"
        position="9.567 0 3.231"
        rotation="0 0 0"
        scale="0.5 0.5 0.5"
      ></a-entity>

      <a-entity
  gltf-model="#chameau"
  position="13.929 0 16.738"
  rotation="0 -90 0"
  scale="0.65 0.65 0.65"
  animation-mixer
></a-entity>

<a-entity
  gltf-model="#banta"
  position="41.546 0 8.677"
  rotation="0 -125.110 0"
  scale="1.5 1.5 1.5"
  animation-mixer
  animation="property: position; to: -5 0 8.677; dur: 30000; easing: linear; loop: true"
></a-entity>

<a-entity
  gltf-model="#trooper"
  position="20.413 0.543 15.689"
  rotation="0 -125.110 0"
  scale="0.7 0.7 0.7"
></a-entity>

<a-entity
  gltf-model="#trooper"
  position="7.601 0.543 6.309"
  rotation="0 -62.150 0"
  scale="0.7 0.7 0.7"
></a-entity>

      <a-entity
        gltf-model="#tie"
        position="150 30 7.606"
        rotation="0 -90 0"
        scale="1 1 1"
        animation="property: position; to: -300 30 7.606; dur: 6000; easing: linear; loop: true"
      ></a-entity>

      <a-entity
      id="milenium"
      gltf-model="#milenium"
      position="225 26.413 7.606"
      scale=" 0.025 0.025 0.025"
      rotation="0 -90 0"
      animation="property: position; to: -225 26.413 7.606; dur: 6000; easing: linear; loop: true">
      
      
      <a-cylinder
      position="-40 26.413 0"
      radius="10"
      rotation="90 0 0"
      scale="0.5 0.5 0.5"
      height="200"
      color="#ff0000"
      animation="property: position; to: 4 26.413 8000; dur: 1000; easing: linear; loop: true">
      ></a-cylinder>
      
      <a-cylinder
      position="40 26.413 200"
      radius="10"
      rotation="90 0 0"
      scale="0.5 0.5 0.5"
      height="200"
      color="#ff0000"
      animation="property: position; to: 10 26.413 8000; dur: 1000; easing: linear; loop: true"></a-cylinder>
      </a-entity>


      <a-entity
        gltf-model="#ATST"
        position="1.080 4.027 12"
        rotation="0 90 0"
        scale="1 1 1"
        animation-mixer
        animation="property: position; to: 45 4.027 12; dur: 30000; easing: linear; loop: true"
      ></a-entity>

      <a-entity
        gltf-model="#destroyer"
        position="-245.467 139.592 20.820"
        rotation="-20 -90 0"
        scale="20 20 20"
      ></a-entity>

      <a-sphere
        position="24.723 3.833 581.876"
        radius="10"
        scale="10 10 10"
        color="#FEE893"
      ></a-sphere>
      <a-sphere
        position="162.861 220.308 533.432"
        radius="10"
        scale="5 5 5"
        color="#FB8C78"
      ></a-sphere>
      
      <a-entity id="cantina-music" sound="src: #cantina_band; autoplay: false; loop: true; positional: true"></a-entity>
      <a-entity id="tatooine-music" sound="src: #tatooine_band; autoplay: true; loop: true; positional: false"></a-entity>

      <a-entity 
      camera 
      wasd-controls="acceleration: 10"
      look-controls="pointerLockEnabled: true"
      universal-controls="movementControls: gamepad, keyboard, touch; movementSpeed: 10"
      position="0 1 0">
    </a-entity>
    </a-scene>

    <script>
      AFRAME.registerComponent("music-controller", {
        init: function () {
          const camera = document.querySelector("[camera]");
          const cantinaMusic = document.querySelector("#cantina-music");
          const tatooineMusic = document.querySelector("#tatooine-music");
          const cantinaPosition = new THREE.Vector3(31.938, -0.026, -13.197);
          const threshold = 10;

          this.el.sceneEl.addEventListener("loaded", () => {
            this.interval = setInterval(() => {
              let cameraPos = camera.object3D.position;
              let distance = cameraPos.distanceTo(cantinaPosition);

              if (distance < threshold) {
                if (cantinaMusic.components.sound && !cantinaMusic.components.sound.isPlaying) {
                  tatooineMusic.components.sound.pause();
                  cantinaMusic.components.sound.play();
                }
              } else {
                if (tatooineMusic.components.sound && !tatooineMusic.components.sound.isPlaying) {
                  cantinaMusic.components.sound.pause();
                  tatooineMusic.components.sound.play();
                }
              }
            }, 500);
          });
        },
        remove: function () {
          clearInterval(this.interval);
        },
      });

      document.querySelector("a-scene").setAttribute("music-controller", "");
    </script>
  </body>
</html>